# ═══════════════════════════════════════════════════════
# FTMO 2-Step Challenge Configuration
# Mode: SWING (hold overnight/weekend, no news restriction)
# ═══════════════════════════════════════════════════════

ftmo_rules:
  # Phase 1 — FTMO Challenge
  phase1:
    profit_target_pct: 0.10        # 10% of initial balance
    max_daily_loss_pct: 0.05       # 5% of initial balance (hard limit)
    max_total_loss_pct: 0.10       # 10% of initial balance (stop-out)
    min_trading_days: 4
    time_limit: null               # Unlimited

  # Phase 2 — Verification
  phase2:
    profit_target_pct: 0.05        # 5% of initial balance
    max_daily_loss_pct: 0.05       # 5% (same)
    max_total_loss_pct: 0.10       # 10% (same)
    min_trading_days: 4
    time_limit: null               # Unlimited

  # FTMO Account (Funded)
  funded:
    profit_target_pct: null        # No profit target
    max_daily_loss_pct: 0.05       # 5% (same)
    max_total_loss_pct: 0.10       # 10% (same)
    profit_split: 0.80             # 80% (up to 90% with scaling)
    scaling_threshold: 0.10        # +10% net over 4 cycles → +25% balance

  # Account type
  account_type: "swing"            # swing | standard
  leverage_crypto: 1.0             # 1:1 for swing crypto
  leverage_forex: 30.0             # 1:30 for swing forex

# ═══════════════════════════════════════════════════════
# Risk Profiles — Mapped to our backtester RiskConfig
# ═══════════════════════════════════════════════════════

profiles:
  challenge:
    label: "Challenge (Phase 1 + 2)"
    description: "Optimisé pour passer le challenge. Sizing modéré, DD strict."
    # Position level
    max_position_pct: 0.15         # 15% max per trade
    risk_per_trade_pct: 0.01       # 1% risk per trade
    # Daily level
    max_daily_loss_pct: 0.04       # 4% (1% marge vs 5% FTMO)
    max_trades_per_day: 5
    cooldown_after_loss: 2         # 2 bars cooldown (4h = 8h pause)
    # Portfolio level
    max_drawdown_pct: 0.08         # 8% circuit breaker (2% marge vs 10%)
    # Emergency shields
    dd_warning_pct: 0.06           # Warning at 6%
    dd_reduce_pct: 0.06            # Reduce sizing 50% at 6%
    dd_emergency_pct: 0.075        # Emergency stop at 7.5%
    profit_lock_pct: 0.08          # Lock profits after 8% gain

  funded:
    label: "Funded Account"
    description: "Durabilité long-terme. Sizing conservateur, DD très strict."
    # Position level
    max_position_pct: 0.10         # 10% max per trade
    risk_per_trade_pct: 0.0075     # 0.75% risk per trade
    # Daily level
    max_daily_loss_pct: 0.035      # 3.5% (1.5% marge vs 5%)
    max_trades_per_day: 4
    cooldown_after_loss: 3         # 3 bars cooldown
    # Portfolio level
    max_drawdown_pct: 0.07         # 7% circuit breaker (3% marge)
    # Emergency shields
    dd_warning_pct: 0.05
    dd_reduce_pct: 0.05
    dd_emergency_pct: 0.065
    profit_lock_pct: null          # No profit lock in funded

# ═══════════════════════════════════════════════════════
# Portfolio Construction
# ═══════════════════════════════════════════════════════

portfolio:
  # Selection criteria (stricter than V5b)
  min_ho_sharpe: 0.5
  min_ho_trades: 5
  max_ho_dd: -0.06                 # Max -6% DD per combo
  max_seed_std: 0.5
  min_win_rate: 0.35
  min_profit_factor: 1.2
  max_losing_streak: 5

  # Diversification
  max_correlation: 0.70
  max_weight_per_combo: 0.25
  max_weight_per_symbol: 0.50
  min_weight: 0.03
  min_unique_strategies: 3
  min_unique_timeframes: 2

  # Timeframes allowed (swing-compatible)
  allowed_timeframes:
    - "4h"
    - "1d"

  # Symbols allowed
  allowed_symbols:
    - "BTCUSDT"
    - "ETHUSDT"
    - "SOLUSDT"

  # Target allocations
  target_allocation:
    BTCUSDT: [0.30, 0.45]          # 30-45%
    ETHUSDT: [0.30, 0.45]          # 30-45%
    SOLUSDT: [0.10, 0.25]          # 10-25%

  # Overlay config
  overlay:
    use_regime: true
    hard_cutoff: true
    min_exposure_threshold: 0.3
    vol_target_annual: 0.25        # Lower than V5b (0.40) for safety

  # Number of combos
  n_combos: 8
  n_monte_carlo: 5000

# ═══════════════════════════════════════════════════════
# FTMO Confidence Scoring
# ═══════════════════════════════════════════════════════

confidence:
  go_threshold: 75
  checks:
    sharpe:
      weight: 15
      thresholds: [1.5, 1.0, 0.5]
      scores: [15, 10, 5]
    max_dd:
      weight: 15
      thresholds: [-0.04, -0.06, -0.08]
      scores: [15, 10, 5]
    daily_max_loss:
      weight: 15
      threshold: -0.03
      score: 15
    win_rate:
      weight: 10
      thresholds: [0.45, 0.40, 0.35]
      scores: [10, 7, 5]
    profit_factor:
      weight: 10
      thresholds: [1.5, 1.3, 1.2]
      scores: [10, 7, 5]
    rolling_sharpe_stable:
      weight: 10
      threshold_pct_positive: 0.65
      score: 10
    mc_pass_probability:
      weight: 15
      thresholds: [0.80, 0.70, 0.60]
      scores: [15, 10, 5]
    multi_seed:
      weight: 5
      score: 5
    max_losing_streak:
      weight: 5
      threshold: 5
      score: 5
